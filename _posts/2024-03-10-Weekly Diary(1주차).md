---
layout: single
title:  "주간 기록(2024.03.04 ~ 2024.03.10)"
excerpt: "1주차 개발 기록 정리"
categories: WeeklyㅤDiary
# tag: [python, blog, food]
toc: true
toc_sticky: true
typora-root-url: ../
auto_profile: false
# sidebar:
#    nav: "docs"
# search: false
---

<br>

**[주간 정규 회의 기록]**  
2024-03-05 (화) 18:00 ~ 22:00  
2024-03-06 (수) 18:00 ~ 22:00  
2024-03-07 (목) 17:00 ~ 22:00  
총 활동 시간: 13시간 00분  
{: .notice--danger .text-center}

> **[주간 정규 활동 기록]**에 기재된 활동 시간은 팀원 모두가 참여한 정규 회의입니다.  
> 개별 활동 및 팀별 활동 시간은 기록되지 않습니다. (**최소 활동 5시간 충족**)

<br>

---

# 1. 주간 활동 정리

## 1) 정규 회의

팀원들 간의 논의를 거쳐 앞으로의 활동은 '**정규 회의**'와 '**팀별(개별) 활동**'으로 구분짓기로 했다. **정규 회의**는 모두가 참석하여 함께 개발에 대한 논의를 진행하는 시간이고, **팀별(개별) 활동**은 각자 맡은 작업을 수행하는 시간이다. 다만 현재 시스템의 특성상 H/W 구현이 선행되어야 팀이 나뉘어져 개발 활동을 진행할 수 있기 때문에 우선 모든 인원이 참여하는 정규 회의를 위주로 진행하고자 하며, H/W 완성을 최우선 목표로 한다.

개강 1주차에는 아래와 같은 시간표로 정규 회의를 진행하고자 하였다. 하지만, H/W 구현에 대한 아이디어를 내기 위해서는 우선 재료가 도착해야 한다는 한계점이 존재하여 일부 수정하여 진행되었다.

<br>

- **정규 회의 계획(1주차)**

  - 월요일: x

  - 화요일: 18:00 ~ 21:00

  - 수요일: 18:00 ~ 21:00

  - 목요일: 12:00 ~ 15:00, 16:30 ~ 21:00

  - 금요일: 09:00 ~21:00

 <br>

- **실제로 진행한 정규 회의(1주차)**
  - 월요일: x
  - 화요일: 18:00 ~ 22:00
  - 수요일: 18:00 ~ 22:00
  - 목요일: 17:00 ~ 22:00
  - 금요일: x

1주차에 겪었던 개발 지연과 같은 문제는 H/W 구성 재료가 모두 도착하면 발생하지 않을 것이므로, 2주차 혹은 3주차에 정규 회의 계획을 확정하도록 하고, 그 이전까지는 팀원들 간의 시간 및 업무 효율성을 고려하며 지속적으로 수정하면서 회의 계획을 갱신하도록 할 예정이다. (*확정 시 다시 기록할 예정*)

<br>

## 2) 개발 기록

1주차는 H/W 설계 및 재료 확정에 대해서 집중적인 논의를 진행하였다. 이전에 보고서를 제출할 때까지는 대략적인 설계만을 제시하였으나, 우리 시스템의 정확도를 높이기 위해서는 반드시 철저한 설계가 동반되어야 한다는 것을 깨닫고 팀원들과 기존에 선정했던 재료와 설계를 재검토하였다.

<br>

# 2. 진행 사항

## 1) H/W 재료 확정

### 카메라모듈 및 렌즈

기존에 구매하기로 결정했던 렌즈는 라즈베리파이 HQ Camera Module에 연결되는 3MP 수준의 렌즈였음. 그런데, 해당 렌즈를 사용할 경우 **카메라모듈 대비 렌즈의 화질이 매우 떨어져 이미지의 대비(밝기)가 매우 떨어질 수 있다는 것을 확인**하게 되었음. 이에 따라 카메라와 렌즈의 관계에 대해서 공부할 필요성을 느끼고 조사해 보았고, 다양한 실사용 사례들을 확인하며 적합성을 확인하고자 하였음.

<br>

- **FOV**(Field of View): 렌즈를 통해서 사진기가 이미지를 담을 수 있는 각

대각선 길이로 계산한 대각선 화각을 가장 많이 사용하며, 보통 그냥 화각이라고 할 때에는 특별한 언급이 없는 이상 대각선 화각을 지칭한다.

<br>

- **Focal Length**(초점 거리): 카메라와 렌즈의 거리

렌즈에는 밀리미터 단위로 초점 거리가 지정되어 있으며, 이는 시야의 각도를 알려준다. 일반적으로 초점 거리가 길수록 시야각이 좁아지고 배율이 높아진다. 초점 거리가 짧을수록 시야각이 넓어지고 배율이 낮아진다.

<br>

- **MOD**(Minimum Object Distance): 대상물과 카메라의 거리에 따라 Focus를 조절하는데, 물체가 접근하면 Focus를 맞출 수 없고, 이때의 거리(가장 근접하여 포커스가 맞은 거리)를 MOD라 한다.

<br>

- **화각(FOV)에 따른 렌즈의 분류**

  - 표준 렌즈

    ![image-20240310212329733](/images/2024-03-09-Weekly Diary(1주차)/image-20240310212329733.png){: .img-width-large}

    위의 이미지에서 alpha를 **화각**(FOV, Field of View)이라고 하는데, 이게 사진을 찍을 수 있는 범위를 나타낸다. 일반적으로 초점 거리에 따라 렌즈를 표준 렌즈/광각 렌즈/망원 렌즈로 구분할 수 있다.

    표준 렌즈는 우리 눈과 가장 유사한 원근감, 화각을 지니며, 그 중에서도 우리 눈과 가장 유사한 원근감을 가진 렌즈는 초점 거리가 50mm이다. 인간의 눈의 화각과 가장 유사한 초점 거리는 50mm보다 더 넓지만, 가장 유사한 원근감은 초점 거리 50mm와 가장 가깝다.

  - 광각 렌즈
  
    ![image-20240310212712728](/images/2024-03-09-Weekly Diary(1주차)/image-20240310212712728.png){: .img-width-large}
  
    일반적으로 렌즈가 35mm보다 작으면 광각렌즈라고 불리며, 이는 더 넓은 각도를 찍을 수 있게 된다. 그러나 광각 렌즈도 가깝게 촬영하면 피사체만 나오게 촬영할 수도 있다.
  
    ![image-20240310213132287](/images/2024-03-09-Weekly Diary(1주차)/image-20240310213132287-1710073892569-1.png){: .img-width-large}
  
    *피사체를 렌즈에 가깝게하여 촬영한 경우*
  
  - 망원 렌즈
  
    ![image-20240310213228197](/images/2024-03-09-Weekly Diary(1주차)/image-20240310213228197.png){: .img-width-large}
  
    망원 렌즈는 이전 렌즈들과 비교했을 때 렌즈 위치만 앞으로 이동한 것이다. 즉, **렌즈의 길이가 길다**는 의미이다. 우리가 주변에서 볼 수 있는 대포처럼 긴 렌즈가 망원 렌즈라고 할 수 있다.
  
    50mm는 표준 렌즈, 35mm 이하는 광각 렌즈라고 하며, 일반적으로 70mm 이상은 주로 망원 렌즈라고 통칭한다. 망원 렌즈의 장점은 인물 사진을 촬영하기 적절하며, 아웃포커싱이 잘 된다는 것이 있지만, 가장 중요한 것은 자연스러움이 크다는 것이다. (*이것은 디지털 카메라 기준이므로, 현재 우리가 사용하는 라즈베리파이 카메라에서는 초점 거리가 더 짧을 수 있음.*)
  
    사람의 눈과 가장 가까운 초점거리는 50mm인데, 만약 200mm 초점거리를 가진 렌즈는 50mm의 4배이므로 4배 줌이 되었지만, 가깝게 보인다고 생각할 수 있다.
  

<br>

> 기존에 사용하고자 했던 3MP 표준 렌즈도 큰 문제는 없으나, 카메라 모듈 대비 성능이 떨어져 고화질 이미지를 얻기 힘들다는 문제가 존재했음. 이에 따라 대체재로서 10MP 망원 렌즈를 고려할 수 있음.  
> 현재 우리는 원단 스와치를 집중적으로 촬영하고자 하므로, MOD가 확보되는 시스템 환경을 구현한다면 고화질의 망원 렌즈를 사용해 적절한 밝기의 원단 스와치 이미지를 얻어낼 수 있을 것으로 생각됨.  
> 이에 따라 망원 렌즈 사용에 추가적인 문제가 없는지 검토해 보았음.

<br>

- **10MP 망원 렌즈의 FOV**

![image-20240310213937337](/images/2024-03-09-Weekly Diary(1주차)/image-20240310213937337.png){: .img-width-large}

위 캡처 이미지는 우리 팀이 구매하고자 하는 망원 렌즈가 지원하는 FOV를 나타낸 사진이다. 망원 렌즈답게 전반적으로 좁은 각도를 촬영한다는 것을 확인할 수 있는데, 해당 FOV로 원단 스와치를 촬영하는데 문제가 없을지 확인하고자 간단한 계산을 수행하였음.

![image-20240310213850766](/images/2024-03-09-Weekly Diary(1주차)/image-20240310213850766.png){: .img-width-large}

간단한 계산을 수행한 결과, 원단을 위치시키는 Target Area의 면적을 100mm x 100mm로 가정하고, Target Area와 렌즈의 거리를 300mm로 가정할 때 FOV(가로)는 약 27도가 나왔음. 망원 렌즈의 성능을 고려할 때, Target Area를 촬영하는 데 문제가 없을 것으로 보임.

<br>

그런데 추가적인 의문 사항이 생겨 조사하였음. 위의 망원 렌즈의 FOV 스펙 이미지를 보면, 길이(Inch)에 따라서 FOV가 변화하는 것을 확인할 수 있음. 일반적으로 초점 거리가 커질수록 FOV가 감소하고, 초점 거리가 작아질수록 FOV가 증가하는 것이 맞는데, 여기서 제시된 스펙에서는 그 반대인 것을 확인할 수 있음. 따라서 여기서 의미하는 길이(Inch)는 다른 것을 의미하는 것이라고 보임.

![image-20240310224240882](/images/2024-03-09-Weekly Diary(1주차)/image-20240310224240882.png){: .img-width-large}

조사해 본 결과, FOV는 위의 식으로 표현될 수 있음. (*FL은 Focal Length이다.*) arctan 함수의 모양을 고려할 때, Focal Length가 증가하면 함수값이 감소하게 되므로, FOV가 작아지는 것이 맞다. 하지만 위의 망원 렌즈 스펙에서는 그 반대의 결과를 보이고 있으므로, 이는 센서(*카메라모듈*)의 대각선 길이를 조절하여 카메라에 들어가는 빛을 감소시키는 방식을 택하는 것이라고 추측된다. (*그러나 이렇게 되면 초점 거리에 따른 배율 조절은 불가능하다는 것이기 때문에, 추가적인 확인이 필요할 것으로 보인다. 해당 망원 렌즈 제조사가 더 이상의 자세한 정보를 제공하지 않아 더 확인할 수는 없었음.*)

결론적으로 현재 망원 렌즈의 스펙에서 Target Area를 촬영하는 데 문제가 없다는 것을 확인하였으므로, 해당 렌즈를 구매하기로 결정하였음.
{: .notice--success .text-center}

<br>

### 조명

기존에 구매하기로 결정했던 조명은 대경LED에서 판매하는 CRI 80의 플리커 프리 제품이다. 그런데 조명에 관해 추가적인 조사를 수행하면서, 국제조명위원회가 CRI 80 자체도 높은 수준의 연색성을 가지는 조명이라고 인정하지만 우리 수준에서 사용하기에는 부족하다는 것을 확인했다. (*색 재현성이 다소 부족함*) 추가적인 조사를 진행한 결과, 색을 다루는 작업에서는 최소한 CRI 90 이상의 조명을 사용하는 것이 좋다는 것을 확인했다. 따라서 새로운 제품을 찾기위해 조사를 수행했다.

<br>

- **CRI에 따른 색 재현율**

<br>

![image-20240310215303002](/images/2024-03-09-Weekly Diary(1주차)/image-20240310215303002.png){: .img-default-setting}

정오의 자연광은 모든 색에 대해서 100%의 색 재현율을 보인다.

![image-20240310215347628](/images/2024-03-09-Weekly Diary(1주차)/image-20240310215347628.png){: .img-default-setting}

그러나 CRI 80 제품은 다소 고르지 못한 색 재현율을 보이며, 이는 특히 R9에서 두드러지는 것을 알 수 있다.

![image-20240310215243536](/images/2024-03-09-Weekly Diary(1주차)/image-20240310215243536.png){: .img-default-setting}

이에 따라 CRI 90 이상의 제품을 확보하여 현재 예산에서 얻을 수 있는 최대한의 결과를 얻고자 했고,  추가적인 조사를 수행하여 대경LED 사에서 CRI 90 이상의 5490 제품을 판매하는 것을 확인하였음. 해당 제품은 LED Bar 형태로, 길이를 설정하여 주문 제작이 가능한 형태이기 때문에 우리 팀에서 활용하기 좋을 것으로 예상했다.

<br>

- **5490 제품 유효성 확인**

1. 5490 제품은 플리커 프리인가?  
   => **플리커 프리 제품 아님.**
2. 410mm로 주문제작, 두 개의 조명이 하나의 컨트롤러로 조작되도록 주문하는 것이 가능한지  
   => **하나의 컨트롤러로 동일하게 조절되도록 주문 제작이 가능하다.**
3. 410mm로 주문제작하면 가격은 변동되는지  
   => **410mm으로 주문제작하면 가격은 약 17,000원 (\*컨트롤러 별도\*), 길이에 따라 변동된다.**

> 조사 결과, 해당 LED의 CRI는 90이며, 길이에 따라 가격도 변동됨을 확인했다. 또한 5490 제품은 별도의 컨트롤러를 부착하여 색온도를 2700K ~ 6500K으로 변경할 수 있을 뿐만 아니라, 조명의 세기도 유동적으로 조절할 수 있음을 확인했다. 우리 팀의 특성 상 조명을 다양한 색온도 및 밝기로 변경해가며 조사해보는 것이 매우 중요하기 때문에, 해당 제품의 이점이 매우 크다는 것을 확인했다.  
>
> 그러나, 한 가지 확인해야 할 사항이 존재했는데, 바로 해당 제품의 밝기가 충분하지 않을 수도 있다는 것이다. 아무리 연색성이 뛰어나더라도 충분한 밝기가 나오지 않으면 문제가 될 수 있다. 이에 따라 조명의 밝기에 대한 추가적인 문의도 진행하였다.

- **5490 제품의 광속**
  - 광속: 100lm/W (*일반적으로 조명의 밝기는 광속으로 표현된다. 이는 광원이 내뿜는 빛의 양이다.*)

확인한 결과, 100lm/W의 광속임을 확인했다. 대경LED의 웹사이트에서 제시된 제품의 W는 1020mm 제품이 14.4 W이므로, 우리가 주문하고자 하는 크기인 220mm에 맞는 W를 알아낼 필요가 있다. LED의 경우 작은 LED 소자를 여러 개 나열하여 만들어낸 것이므로, 광속을 비례적으로 계산하여도 큰 문제가 없을 것이라고 판단하여 대략적인 수치를 확인하였다.

<br>

1020:14.4 = 220:x

1020/14.4 = 220/x

70.83 = 220/x

x = 220/70.83

x = 3.1

<br>

따라서 5490 제품의 소비 전력은 약 3.1W이고, 광속은 310lm 가량이라고 볼 수 있다. 일반적으로 스마트폰 플래시가 100lm 정도의 광속을 보이는 것을 고려할 때, 밝기는 문제 없을 것이라고 보인다. 또한 시스템 H/W 전체를 밝히기 위해서 동일한 LEd 네 개를 사용할 것이기 때문에 밝기는 충분할 것이라고 생각된다.

이전에 비슷한 암실 상자(*Black Box*)를 구성하고 팀원들 네 명의 스마트폰 플래시를 사용하여 원단 스와치를 비춰본 적이 있는데, 상당히 만족스러운 결과를 얻어낼 수 있었다. 따라서 현재 조명이 가장 탁월한 선택인 것으로 보인다.

<br>

- **5490 제품 주문 제작 구성도**

![image-20240310222051136](/images/2024-03-09-Weekly Diary(1주차)/image-20240310222051136.png){: .img-width-large}

<br>

- **Non Flicker Free**

그러나 문제가 될 수 있는 것이 한 가지 존재하는데, 바로 5490 제품은 Flicker Free 제품이 아니라는 것이다. Flicker 현상이란, 가정에서 사용되는 220V 교류 전류의 특성으로 인해 전압이 0이 되는 구간이 존재하여 조명이 꺼졌다가 켜지는 현상을 말한다. 대한민국은 60Hz의 교류 전류를 사용하기 때문에 조명이 1초에 60번 가량 꺼졌다가 켜진다고 생각할 수 있는데, 만약 이때 이미지가 촬영된다면 잘못된 결과를 얻을 수 있기 때문에 문제가 될 수 있다. 

그런데 조사해 본 결과, 라즈베리파이 HQ Camera Module 자체적으로 50Hz, 60Hz Anti-Flicker Mode를 지원하기 때문에, 이 기능을 활용하면 큰 문제는 없을 것으로 보인다. 이 것으로 방지가 불가능하다면, 여러 장의 사진을 촬영하여 이 중에서 문제가 없는 것을 찾아내는 알고리즘을 설계해 Target Image를 결정하는 방식을 사용해도 될 것이다.

<br>

### H/W 구성 원자재

기존에는 3D 프린터를 이용하여 설계하고자 하였으나, 비용적인 측면에서 불가능하다는 것을 확인함. (*필라멘트 가격이 매우 비쌈*) 따라서 비용적/실용적 측면에서 대체할 수 있는 재료로 경도가 적당한 3T 아크릴을 선택하였음. 빛의 반사를 최대한 줄이기 위하여 불투명 무광 아크릴을 사용하기로 하였으며, 색깔에 대해서 집중 논의를 진행하였음.

<br>

- **흰색 아크릴**

흰색 무광 아크릴로 할 경우, 빛 반사가 가장 심하게 될 수 있다. 흰색은 빛을 대부분 반사하는데, 이로 인해 빛이 여러 방향으로 반사되어 Target Area에 그림자나 빛으로 영향을 줄 수 있다. 그러나 조명을 충분히 강하게 한다면 오히려 많은 빛이 벽면에 반사가 되어서 조도가 고르게 측정 될 가능성이 존재하며, 조도 센서를 사용해 조도에 따른 보정을 진행하므로, 큰 문제가 되지 않을 수 있음.

<br>

- **검은색 아크릴**

검은색 무광으로 하면 최대한 벽면의 반사를 줄여서 스와치에 조도를 보다 균일하게 할 수 있음 벽면이 반사가 안되어야 컨트롤 해야하는 변수가 줄어들지만, 현재 선택한 대경 LED의 5490 제품이 확산형 LED이므로 조명의 밝기를 극대화하지 못하게 할 수 있다.

<br>

결과적으로 우선 흰색 아크릴을 주문하고, 빛 반사에 의한 통제가 제대로 이루어지지 못할 경우,  
내부에 검은색 테이프를 부착하여 빛 반사를 통제하는 환경으로 구성하기로 결정하였다.   
그러나 현재 디바이스마트에서 아크릴 판매가 중단되어 구매하지 못하였음. 추후 대책 논의 예정.  
{: .notice--success .text-center}

<br>

### 재료 주문

![img](https://cdn.discordapp.com/attachments/1186187051243143218/1215551975983415296/image.png?ex=65fd29fe&is=65eab4fe&hm=f51409e4d9c0d1fb2b44e57f6d4d00de4b8036df678fea7fe66fe7f8afb34fb8&=){: .img-width-large}

아크릴을 주문할 수 없었기 때문에, 우선적으로 아크릴을 제외하고 위의 재료들을 주문하였음.  
해당 재료들이 도착하는 대로 임시적인 실험 환경을 조성해 개발을 진행할 예정임.
{: .notice--success .text-center}

<br>

## 2) 시스템 H/W 재설계

### H/W 정밀 설계 논의

보고서에 제출할 때 첨부한 설계도는 매우 기초적인 수준이기 때문에 실제로 제작을 진행하기에는 무리가 존재했다. 따라서 H/W 외형을 구성할 아크릴을 주문하기 이전에 정확한 수치적 설계를 진행할 필요가 있다.

<br>

- **조도 측정 모듈**

원단의 지역적 조도 차이에 따라서 얻어지는 RGB 값이 다를 수 있기 때문에, 별도의 조도 측정 모듈을 만들어 매 측정마다 실시간으로 조도를 측정할 수 있어야 한다. 문제는 현재 특성 상 해당 H/W를 구현하는 것이 어렵다는 것인데, 이에 따라 별도의 모듈부를 구현하고자 한다. 해당 내용은 아래에 작성하였다.

<br>

- **전체 H/W 설계**

주문한 조명의 크기와 배선, 라즈베리파이의 위치와 조도 측정 모듈을 고려하여 어떻게 시스템 H/W를 설계하는 것이 좋을지 논의를 진행하였다.

 ![image-20240310223050640](/images/2024-03-09-Weekly Diary(1주차)/image-20240310223050640.png){: .img-width-large}

=> 논의를 진행하고 있는 과정에서 촬영한 이미지. 조명의 부착 위치와 조도 측정 모듈 및 모듈부의 구성에 관해 집중적으로 논의함.

<br>

![image-20240310222934575](/images/2024-03-09-Weekly Diary(1주차)/image-20240310222934575.png){: .img-width-large}

> 결과적으로 위와 같은 형태로 시스템 H/W를 구성하기로 결정하였음. 아직 전체 설계가 완료된 것은 아니기 때문에 추가적인 논의가 필요할 것으로 생각되지만, 다음 내용에 대해서는 대략적으로 확정되었음.

<br>

***모듈부***

모듈부란, 위의 설계도에서 우측에 존재하는 100 x 300 x 400 크기의 공간이다. (*가장 우측에 적힌 294는 잘못 적힌 수치로, 3T 아크릴의 두께를 고려하여 설정된 것임. 실제로는 394가 맞음.*) 해당 부분에 조도 측정 모듈, 라즈베리파이 및 배선이 위치할 예정이며, 해당 부분을 조작할 수 있도록 경첩을 달아 우측면과 천장이 움직이는 형태로 'ㄱ'자 문을 만들 예정임.

<br>

**조도 측정 모듈**

조도 측정 모듈은 매 측정마다 실시간으로 조도를 측정하는 부분을 말한다. 모듈부에 위치하며, 모터를 이용해 Target Area 위에 정확히 포개지는 형태로 만들고자 함. 자세한 설계는 추후에 추가로 진행할 예정임. 

![image-20240310223720665](/images/2024-03-09-Weekly Diary(1주차)/image-20240310223723544.png){: .img-width-large}

<br>

***조명***

조명의 부착 위치는 현재까지 확정되지 않았으며, 양면 테이프를 이용해 LED를 다양한 방식으로 부착해보며 가장 우수한 결과를 보이는 환경을 조성하고자 함. 대표적인 예시로는 아래와 같은 경우를 예로 들 수 있음.

![image-20240310224037297](/images/2024-03-09-Weekly Diary(1주차)/image-20240310224037297.png){: .img-default-setting}

<br>

## 3) 알고리즘에 대한 논의

### 오차 보정 알고리즘과 CNN

기존에 활용하고자 하는 방식은 Label을 이용한 **Sensor Calibration** 방식이다. 그런데 이 방식은 반드시 조명 환경이 통제되어야 하며, 조도 측정을 통해 실시간으로 보정해야 한다는 한계가 존재한다. 즉, 철저하게 통제되지 않으면 원하는 결과를 얻지 못할 수도 있다는 것이다. 따라서 우선적으로는 **Sensor Calibration** 방식을 최우선으로 고려하여 어떠한 알고리즘을 통해 보정을 진행할 것인지 논의하고자 한다. 그런데 해당 알고리즘이 적절한 성능을 보이지 못할 경우 조명 환경에 대한 한계를 극복할 수 있는 간단한 **CNN** 모델을 활용하는 것을 고려하고자 한다.

<br>

### Sensor Calibration

조도 센서를 활용한 보정값을 생성할 경우, 각 픽셀별로 값을 생성하는 것이 가장 좋다. 하지만 이는 현실적이지 않은 방법일 수 있다. 따라서 보고서에 작성했던 대로 1점법과 4점법을 결합하여 지역적 보정값을 생성하는 것이 가장 합리적이라고 볼 수 있다.

그런데 문제는 '**동일한 보정값을 갖는 지역을 어떻게 구분할 것인가**'이다. 이는 알고리즘적인 문제로 이어지기 때문에, 팀원들과 어떻게 지역을 나누고 보정할 것인가에 대해서 논의를 진행하였다. 그러나 실질적으로는 H/W 환경이 어느정도 구성된 이후에 실험적으로 확인하는 것이 가장 효과적일 것이라고 판단했고, 이에 따라 논의 내용을 간략하게만 작성하고자 한다.

<br>

- **Image Crop**

![image-20240310225538341](/images/2024-03-09-Weekly Diary(1주차)/image-20240310225538341.png){: .img-default-setting}

스와치의 경우, 가장자리가 울퉁불퉁한 형태이기 때문에 이미지를 Crop할 필요가 있다. 따라서 위의 이미지와 같이 Target Area를 구성한다. 검은색은 100mm x 100mm의 크기이며, 내부에 빨간색 부분만큼 이미지가 촬영되도록 Crop한다. 따라서 원단 스와치는 반드시 검은색 영역 내부에 존재해야 하며, 빨간색 영역을 모두 덮어야 한다.

<br>

- **지역 분할 알고리즘**
  - *파란색*: 조명
  - *노란색 동그라미*: 조도 센서
  - *노란색 실선*: 지역 분할 (*네 개의 지역으로 나뉘며, 각 지역은 같은 보정값을 가짐.*)

![image-20240310225714727](/images/2024-03-09-Weekly Diary(1주차)/image-20240310225714727-1710079035022-3.png){: .img-default-setting}

알고리즘에 대한 논의를 진행하기 위해서, H/W 환경이 위와 같다고 가정한다. 이때 파란색 조명은 Target Area를 수직으로 비추는 것이 아니라, H/W 천장의 가장자리에 네모낳게 부착되어 있는 것이다. 

<br>

1. **조도를 반영하지 않고 보정값을 생성하는 경우**
   - 지역 내 모든 픽셀 값의 평균을 바탕으로 보정값 생성
   - Kernel을 만들어서 Sliding 진행, 이를 통해 지역 내 픽셀 값의 스무딩 값을 바탕으로 보정값 생성
2. **조도를 반영하고 보정값을 생성하는 경우**
   - 지역의 조도 비율을 고려하여 보정값 생성  
     ex) 섹터1의 R 평균이 150, 섹터2의 R 평균이 130이라고 하자. 이때 Label이 R 100이다. 그렇다면 섹터1은 c1: -50, 섹터2는 c2: -30이다. 그런데 만약 섹터1과 2의 조도 비가 2:1이었다면, 조도비를 고려하여 c1, c2에 적절한 연산을 수행해 보정값을 생성한다. 실험적으로 조도의 절대치에 대한 보정값을 생성하고, 구해진 조도 비에 따라서 보정값을 변경하는 방식으로 수행할 수도 있다.

![image-20240310230930339](/images/2024-03-10-Weekly Diary(1주차)/image-20240310230930339.png){: .img-default-setting}

- 커널의 좌표에 따라서 근처에 위치한 조도 값의 영향을 많이 받도록 보정값 생성  
  ex) 커널의 위치에 따라서, 네 개 지역의 조도 영향을 비례적으로 받아 보정값을 생성하는 방식.

![image-20240310230943334](/images/2024-03-10-Weekly Diary(1주차)/image-20240310230943334.png){: .img-default-setting}

> 위에서 언급된 내용은 확정된 내용이 아닌 단순한 아이디어이며, H/W 환경이 구성된 이후에 해당 내용을 다시 논의하며 정확한 알고리즘을 확정하고자 한다.

<br>

- **RGB 3차원 공간에서의 밝기**

![image-20240310231144140](/images/2024-03-10-Weekly Diary(1주차)/image-20240310231144140.png){: .img-width-large}

RGB 3차원 공간에서 특정한 색의 밝기는 위와 같이 나타낼 수 있으며, (0, 0, 0)과 (255, 255, 255)를 잇는 벡터를 법선 벡터로 갖는 평면에 대해서, 같은 평면에 위치할 경우 같은 밝기의 색상이라고 말할 수 있다. 이를 이용하여 **밝기에 대한 보정**을 먼저 수행한 후, **색채에 대한 보정**을 수행하는 방법을 고려할 수도 있다.

![image-20240310231305514](/images/2024-03-10-Weekly Diary(1주차)/image-20240310231305514.png){: .img-width-large} 

> Brightness 보정과 Color 보정에 대한 논의. 상식적으로, 모든 원단 스와치는 조명 위에서 Label보다 밝아지게 될 것이다. 따라서 Sample의 Brightness 평면을 Label의 Brightness 평면까지 축소시킨 후 색채에 대한 보정을 수행하는 것을 고려할 수 있다. 그러나 이것은 현재 수준에서 수행하기는 어렵고, 어느정도 실험적인 확인이 필요한 부분인 것으로 생각되어 H/W 구성 이후에 진행할 수 있을 것으로 생각된다.

<br>

### CNN

조도 측정 모듈을 구성한 후 Sensor Calibration을 수행해보고, 해당 방식으로 적절한 결과를 얻어내기 힘들다면 사용하는 것을 고려해볼 수 있다. 그러나 팀을 나눠 CNN을 활용하여 색상을 추론하는 방식을 간단하게 확인해 볼 수는 있을 것이다.

<br>

### 레퍼런스 스와치

기존에 활용하고자 했던 레퍼런스 스와치는 면 재질로, 전문 용어로는 TCX라고 부른다. 이와 유사하지만 약간 다른 것으로는 TPG가 있는데, TPG는 TCX와 색상은 동일하지만 종이 재질로 만들어진 것이다. 따라서 TCX와는 약간의 밝기 차이가 존재하지만, 가격이 훨씬 싸다는 장점이 있다. 이에 따라 TPG와 TCX의 차이를 확인하고 이를 극복할 수 있다면, TCX를 사용하지 않고도 TPG만으로 원하는 결과를 얻을 수 있다.

그러나 이 방식은 올바른 결과가 도출되는지 확인하기 위하여 반드시 소수의 TCX라도 필요하므로 TCX를 사용하지 않을 수는 없다. 따라서 어떠한 TCX를 구할 것인지 추가적인 논의를 진행해 보아야 한다.

<br>

# 3. 향후 계획

- 주문한 H/W 재료가 도착하는 대로 임시적인 실험 환경을 조성하여 H/W 설계 확정
- 해당 설계를 바탕으로 아크릴을 주문하여 통제된 시스템 H/W(*실험 환경*) 조성
- 시스템 H/W를 활용해 보정값 생성 알고리즘 개발
  - Sensor Calibration
  - CNN
- 다색상 원단에 대한 DBSCAN 알고리즘 설계
  - 보정값이 생성되기 이전에 모듈 생성 및 유효성 검증 가능

<br>
